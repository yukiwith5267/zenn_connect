---
title: "ã€OpenCV + Pythonã€‘LINE Notifyã§å‹•ä½“æ¤œçŸ¥ã‚’çŸ¥ã‚‰ã›ã‚‹"
emoji: "ğŸ¶"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Python, OpenCV]
published: true
---

## ã€OpenCV + Pythonã€‘LINE Notify ã§å‹•ä½“æ¤œçŸ¥ã‚’çŸ¥ã‚‰ã›ã‚‹

### å‹•ä½œç’°å¢ƒ

- OS: macOS Ventura Version13.3.1
- Python 3.9.13
- OpenCV 4.7.0

OpenCV ã¯ pip install opencv-python ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰

```python
import cv2
import time
import requests
import json

# LINE Notify token (replace with your own)
LINE_NOTIFY_TOKEN = "YOUR_LINE_NOTIFY_TOKEN"

# movie = cv2.VideoCapture('./movie/park.mp4')
movie = cv2.VideoCapture(0)
red = (0, 0, 255) # æ ç·šã®è‰²
before = None # å‰å›ã®ç”»åƒã‚’ä¿å­˜ã™ã‚‹å¤‰æ•°
fps = int(movie.get(cv2.CAP_PROP_FPS)) #å‹•ç”»ã®FPSã‚’å–å¾—

while True:
    # ç”»åƒã‚’å–å¾—
    ret, frame = movie.read()
    # å†ç”ŸãŒçµ‚äº†ã—ãŸã‚‰ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹
    if ret == False: break
    # ç™½é»’ç”»åƒã«å¤‰æ›
    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)

    if before is None:
        before = gray.astype("float")
        continue
    #ç¾åœ¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã¨ç§»å‹•å¹³å‡ã¨ã®å·®ã‚’è¨ˆç®—
    cv2.accumulateWeighted(gray, before, 0.8)
    frameDelta = cv2.absdiff(gray, cv2.convertScaleAbs(before))
    #frameDeltaã®ç”»åƒã‚’ï¼’å€¤åŒ–
    thresh = cv2.threshold(frameDelta, 3, 255, cv2.THRESH_BINARY)[1]
    #è¼ªéƒ­ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾—ã‚‹
    contours = cv2.findContours(thresh,
                    cv2.RETR_EXTERNAL,
                    cv2.CHAIN_APPROX_SIMPLE)[0]

    # å·®åˆ†ãŒã‚ã£ãŸç‚¹ã‚’ç”»é¢ã«æã
    for target in contours:
        x, y, w, h = cv2.boundingRect(target)
        if w < 30: continue # å°ã•ãªå¤‰æ›´ç‚¹ã¯ç„¡è¦–
        cv2.rectangle(frame, (x, y), (x+w, y+h), red, 2)

        # Send LINE notification when motion is detected
        payload = {"message": "Motion detected!"}
        headers = {"Authorization": "Bearer " + LINE_NOTIFY_TOKEN}
        requests.post("https://notify-api.line.me/api/notify", data=payload, headers=headers)

    #ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã®å†ç”Ÿé€Ÿåº¦ã‚’å…ƒå‹•ç”»ã¨åˆã‚ã›ã‚‹
    time.sleep(1/fps)
    # ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§è¡¨ç¤º
    cv2.imshow('target_frame', frame)
    # Enterã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã‚‰ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹
    if cv2.waitKey(1) == 13: break

#å†…è”µã‚«ãƒ¡ãƒ©ã‚’è§£æ”¾ã™ã‚‹
movie.release()
cv2.destroyAllWindows() # ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ç ´æ£„

```

```
movie = cv2.VideoCapture(0)
```

å¼•æ•°ã§ä½¿ç”¨ã‚«ãƒ¡ãƒ©ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚(0 ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å†…è”µã‚«ãƒ¡ãƒ©)

```
YOUR_LINE_NOTIFY_TOKEN
```

ã« LINE Notify ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä»£å…¥ã—ã¾ã™ã€‚

LINE Notify ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œæ–¹æ³•ã¯ã“ã¡ã‚‰

https://firestorage.jp/business/line-notify/

### çµæœ

![](https://storage.googleapis.com/zenn-user-upload/1a8f0a3ec461-20230524.png)

å‹•ä½“æ¤œçŸ¥ã—ãŸã‚‰ã“ã‚“ãªæ„Ÿã˜ã«æ ç·šã§ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã—ã€LINE Notify ã§çŸ¥ã‚‰ã›ã¦ãã‚ŒãŸã€‚

### æ„Ÿæƒ³

éå‰°ã«æ¤œå‡ºã—ã¦é€šçŸ¥ã—ã¦ã—ã¾ã†ã®ã‚’ç¨‹ã‚ˆãæŠ‘ãˆã‚‹ã®ãŒè‹¦åŠ´ã—ãŸã€‚

å­¦ç¿’ç‡ã‚’å¤‰æ›´ã—ãŸã‚Šã€ãƒ•ãƒ¬ãƒ¼ãƒ é–“ã®å·®åˆ†ã®é–¾å€¤ã‚’å¤‰ãˆãŸã‚Šã—ã¦ã€è©¦è¡ŒéŒ¯èª¤ã—ãŸã€‚
è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ã€å­¦ç¿’ç‡ã‚’ 0.975 ãã‚‰ã„ã«è¨­å®šã—ã¦ã¡ã‚‡ã†ã©ã‚ˆãå‹•ä½“æ¤œçŸ¥ã—ã¦ãã‚ŒãŸã€‚

éŒ²ç”»ã•ã‚Œãªã„ ZOOM ã®æˆæ¥­ã¨ã‹ã‚’å‹•ä½“æ¤œçŸ¥ã—ã¦ã€ã‚¹ãƒ©ã‚¤ãƒ‰ãŒå‹•ã„ãŸã‚‰ã‚¹ã‚¯ã‚·ãƒ§ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã‹ã‚‚ä½œã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚
